---
title: ""
output:
  html_document:
    highlight: "tango"
editor_options: 
  chunk_output_type: inline
---

```{r state-outside-script, results="hide", warning=FALSE, message=FALSE, include = FALSE}
# source("script/variable/setup.R")
# source("script/variable/colors.R") #colors 
# source("script/dataframe/covid19.R") #run script for covid19 df 
# source("script/variable/parameters.R") #global parameters 
```

```{r state-facet-data}
facet_data <- covid19 %>%
  filter(geo %in% c(state.abb, "DC")) %>% 
  filter(date >= x_min) #x_min from parameters.R file 
```


```{r state-MA7-free}
title <- paste("7-Day Moving Average of New Cases")
subtitle <- paste(x_min, "to", x_max) #x_min/x_max from parameters.R file 
  
ggplot(facet_data, aes(date, case_MA7)) + 
    geom_area(fill = blue_comp, alpha = 0.2) + 
    geom_line(color = blue_comp) + 
    facet_geo(~geo, grid = "us_state_grid2" , labeller = adjust_labels, scales = "free") +
    scale_x_date(      name = NULL, breaks = NULL, expand = c(0, 0)) + 
    scale_y_continuous(name = NULL, breaks = NULL, expand = c(0, 0)
                       , limits = c(0, NA)
                       ) +
    theme_minimal() +
    labs(
      title = title
      , subtitle = subtitle
      , caption = paste("Scales are free\nThis plot is not to compare numbers state to state",
                        "but to look at curves and where cases are increasing or decreasing")
    ) +
    theme_minimal() +
    theme(
        strip.text = element_text(margin = margin(3, 3, 3, 3), face = "bold")
      , plot.title = element_text(face = "bold", hjust = 0.5)
      , plot.subtitle = element_text(hjust = 0.5, size = 12)
      , panel.grid = element_blank()
    ) 
```


```{r state-MA7-PC}

title <- paste("Per-Capita 7-Day Moving Average of New Cases")
subtitle <- paste(x_min, "to", x_max) #x_min/x_max from parameters.R file 

max_val <- facet_data %>% pull(case_MA7_PC) %>% max()
  
ggplot(facet_data, aes(date, case_MA7_PC)) + 
    geom_area(fill = blue_comp, alpha = 0.2) + 
    geom_line(color = blue_comp) + 
    facet_geo(~geo, grid = "us_state_grid2" , labeller = adjust_labels, scales = "fixed") +
    scale_x_date(      name = NULL, breaks = NULL, expand = c(0, 0)) + 
    scale_y_continuous(name = NULL, breaks = NULL, expand = c(0, 0)
                       , limits = c(0, NA)
                       ) +
    theme_minimal() +
    labs(
      title = title
      , subtitle = subtitle
      , caption = paste("Scales are fixed")
    ) +
    theme_minimal() +
    theme(
        strip.text = element_text(margin = margin(3, 3, 3, 3), face = "bold")
      , plot.title = element_text(face = "bold", hjust = 0.5)
      , plot.subtitle = element_text(hjust = 0.5, size = 12)
      , panel.grid = element_blank()
    ) 
```




```{r, out.width = "100%", eval = FALSE }
### Take a Closer Look! 

# Build your own plot for a given state and time period by using a shiny app.  The app can be access through this  link, <a href="https://mareichler.shinyapps.io/diy-covid19-plots/" target = "_blank">mareichler.shinyapps.io/diy-covid19-plots/</a>, and is also embedded below:  
# knitr::include_app("https://mareichler.shinyapps.io/diy-covid19-plots/", height = "500px")
```






